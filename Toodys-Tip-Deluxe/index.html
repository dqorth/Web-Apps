<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toodie's TipSplit Deluxe - Refactored</title>
    <link rel="stylesheet" href="css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <!-- Favicon links -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="assets/favicon/site.webmanifest">
    <!-- Added theme-color meta tags -->
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">Toodie's TipSplit Deluxe</div>
            <nav class="nav">
                <button class="nav-btn active" data-section="employee-management">Employee Management</button>
                <button class="nav-btn" data-section="daily-shifts">Daily Shifts</button>
                <button class="nav-btn" data-section="reports">Reports</button>
                <button class="nav-btn" data-section="settings">Settings</button>
                <button id="tutorialBtn" class="nav-btn tutorial-btn">Tutorial</button>
            </nav>
        </header>

        <main class="main-content">
            <!-- Employee Management Section -->
            <section id="employee-management" class="content-section active">
                <div class="section-header">
                    <h2>Employee Management</h2>
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="roster-management">Roster Management</button>
                        <button class="tab-btn" data-tab="daily-lineup">Daily Lineup</button>
                    </div>
                </div>

                <!-- Roster Management Tab Content -->
                <div id="roster-management" class="tab-content active">
                    <div class="subsection">
                        <h3>Add/Edit Employee</h3>
                        <form id="addEmployeeForm" class="form-grid">
                            <div class="form-group">
                                <label for="employeeNameInput">Employee Name:</label>
                                <input type="text" id="employeeNameInput" placeholder="e.g., Alice Wonderland">
                            </div>
                            <div class="form-group">
                                <label>Positions:</label>
                                <div id="employeePositionsContainer" class="checkbox-group">
                                    <!-- Position checkboxes will be dynamically populated here -->
                                    <!-- Example: <label><input type="checkbox" name="positions" value="Server"> Server</label> -->
                                </div>
                            </div>
                            <input type="hidden" id="editingEmployeeId">
                            <div class="form-actions">
                                <button type="submit" id="saveEmployeeBtn" class="btn btn-primary">Save Employee</button>
                                <button type="button" id="cancelEditEmployeeBtn" class="btn btn-secondary" style="display: none;">Cancel Edit</button>
                            </div>
                        </form>
                    </div>

                    <div class="subsection">
                        <h3>Import Roster</h3>
                        <div id="importEmployeeSection" class="form-grid">
                            <div class="form-group">
                                <label for="employeeImportFileInput" class="btn btn-secondary">Choose .txt File</label>
                                <input type="file" id="employeeImportFileInput" accept=".txt" style="display: none;">
                                <span id="importFileNameDisplay" class="file-name-display">No file chosen</span>
                            </div>
                            <button id="importEmployeesBtn" class="btn btn-primary">Import Roster</button>
                            <div id="importStatusMessages" class="status-messages"></div>
                        </div>
                    </div>
                    
                    <div class="subsection">
                        <h3>Current Roster</h3>
                        <div class="search-bar">
                            <input type="text" id="employeeSearchInput" placeholder="Search employees...">
                        </div>
                        <div id="employeeListContainer" class="table-container">
                            <!-- Employee list table will be populated here by JS -->
                            <p>Loading roster...</p>
                        </div>
                    </div>
                </div>

                <!-- Daily Lineup Tab Content -->
                <div id="daily-lineup" class="tab-content">
                    <div class="subsection">
                        <div class="date-navigation" id="lineupDateNav">
                            <button id="prevLineupDayBtn" class="btn btn-secondary">&laquo; Previous Day</button>
                            <span id="currentLineupDateDisplay" class="date-display">YYYY-MM-DD</span>
                            <button id="nextLineupDayBtn" class="btn btn-secondary">Next Day &raquo;</button>
                            <input type="date" id="lineupDatePicker" class="date-picker">
                        </div>
                        <h3>Daily Lineup for <span id="lineupDateForTitle">Date</span></h3>
                        <div id="availableEmployeesContainer" class="available-employees-list">
                            <h4>Available Employees (Drag to Lineup)</h4>
                            <!-- Available employees will be populated here by JS -->
                        </div>
                        <div id="dailyRosterContainer" class="daily-roster-list">
                            <h4>Today's Lineup (Drag to reorder or remove)</h4>
                            <!-- Daily roster will be populated here by JS -->
                        </div>
                        <button id="saveLineupBtn" class="btn btn-primary">Save Lineup</button>
                         <p class="instructions">Drag employees from "Available" to "Today's Lineup" or vice-versa. Drag within "Today's Lineup" to reorder.</p>
                    </div>
                </div>
            </section>

            <!-- Daily Shifts Section -->
            <section id="daily-shifts" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>Daily Shifts & Tip Entry</h2>
                </div>
                <div class="date-navigation" id="shiftsDateNav">
                    <button id="prevShiftsDayBtn" class="btn btn-secondary">&laquo; Previous Day</button>
                    <span id="currentShiftsDateDisplay" class="date-display">YYYY-MM-DD</span>
                    <button id="nextShiftsDayBtn" class="btn btn-secondary">Next Day &raquo;</button>
                    <input type="date" id="shiftsDatePicker" class="date-picker">
                </div>

                <div class="subsection">
                    <h3>Add/Edit Shift for <span id="shiftDateForTitle">Date</span></h3>
                    <form id="shiftEntryForm" class="form-grid-halves">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="shiftEmployeeSelect">Employee:</label>
                                <select id="shiftEmployeeSelect">
                                    <option value="">Select Employee</option>
                                    <!-- Options populated by JS based on daily lineup -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="shiftPositionSelect">Position:</label>
                                <select id="shiftPositionSelect">
                                    <!-- Options populated by JS based on selected employee's positions -->
                                </select>
                            </div>
                            <div class="form-group time-inputs">
                                <label for="shiftStartTime">Start Time:</label>
                                <input type="time" id="shiftStartTime">
                                <label for="shiftEndTime">End Time:</label>
                                <input type="time" id="shiftEndTime">
                            </div>
                             <div class="form-group">
                                <label for="shiftBreakDuration">Break (minutes):</label>
                                <input type="number" id="shiftBreakDuration" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label for="shiftHours">Total Hours (auto-calculated):</label>
                                <input type="text" id="shiftHours" readonly>
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label for="shiftCashTips">Cash Tips:</label>
                                <input type="number" id="shiftCashTips" placeholder="0.00" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label for="shiftCCTips">Credit Card Tips:</label>
                                <input type="number" id="shiftCCTips" placeholder="0.00" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label for="shiftTipOut">Tip Out (Cash Given Out):</label>
                                <input type="number" id="shiftTipOut" placeholder="0.00" step="0.01" min="0">
                            </div>
                             <input type="hidden" id="editingShiftId">
                            <div class="form-actions">
                                <button type="submit" id="addOrUpdateShiftBtn" class="btn btn-primary">Add/Update Shift</button>
                                <button type="button" id="clearShiftFormBtn" class="btn btn-secondary">Clear Form</button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="subsection">
                    <h3>Shifts Logged for <span id="shiftsTableDateForTitle">Date</span></h3>
                    <div id="dailyShiftsTableContainer" class="table-container">
                        <!-- Daily shifts table will be populated here -->
                        <p>No shifts logged for this day yet.</p>
                    </div>
                    <div class="totals-summary">
                        <h4>Daily Totals:</h4>
                        <p>Total Cash Tips: <span id="dailyTotalCashTips">$0.00</span></p>
                        <p>Total CC Tips: <span id="dailyTotalCCTips">$0.00</span></p>
                        <p>Total Tip Out: <span id="dailyTotalTipOut">$0.00</span></p>
                        <p><strong>Net Tips for Distribution: <span id="dailyNetTips">$0.00</span></strong></p>
                    </div>
                </div>
                 <div class="subsection">
                    <h3>Tip Distribution for <span id="tipDistributionDateForTitle">Date</span></h3>
                    <button id="calculateTipDistributionBtn" class="btn btn-primary">Calculate & View Distribution</button>
                    <div id="tipDistributionResultsContainer" class="table-container" style="margin-top:15px;">
                        <!-- Tip distribution results will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>Reports</h2>
                     <div class="tabs">
                        <button class="tab-btn active" data-tab="weekly-summary">Weekly Summary</button>
                        <button class="tab-btn" data-tab="pay-period-summary">Pay Period Summary</button>
                        <button class="tab-btn" data-tab="employee-summary">Employee Summary</button>
                    </div>
                </div>

                <!-- Weekly Summary Tab -->
                <div id="weekly-summary" class="tab-content active">
                    <div class="report-controls">
                        <div class="date-navigation" id="reportWeekNav">
                            <button id="prevReportWeekBtn" class="btn btn-secondary">&laquo; Previous Week</button>
                            <span id="currentReportWeekDisplay" class="date-display">Week X (YYYY-MM-DD to YYYY-MM-DD)</span>
                            <button id="nextReportWeekBtn" class="btn btn-secondary">Next Week &raquo;</button>
                        </div>
                        <button id="exportWeeklyReportBtn" class="btn btn-primary">Export Weekly (XLSX)</button>
                    </div>
                    <div id="weeklyReportContentArea" class="table-container report-area">
                        <!-- Weekly report content will be populated here -->
                        <p>Select a week to view the report.</p>
                    </div>
                </div>

                <!-- Pay Period Summary Tab -->
                <div id="pay-period-summary" class="tab-content">
                    <div class="report-controls">
                        <div class="form-group">
                            <label for="reportCycleStartDateSelect">Select Pay Cycle Start Date:</label>
                            <select id="reportCycleStartDateSelect">
                                <!-- Options populated by JS -->
                            </select>
                        </div>
                         <div class="form-group">
                            <label for="reportPayPeriodLengthSelect">Pay Period Length (weeks):</label>
                            <select id="reportPayPeriodLengthSelect">
                                <option value="1">1 Week</option>
                                <option value="2" selected>2 Weeks</option>
                                <option value="3">3 Weeks</option>
                                <option value="4">4 Weeks</option>
                            </select>
                        </div>
                        <button id="generatePayPeriodReportBtn" class="btn btn-primary">Generate Pay Period Report</button>
                        <button id="exportPayPeriodReportBtn" class="btn btn-success" style="display:none;">Export Period (XLSX)</button>
                    </div>
                    <div id="payPeriodReportContentArea" class="table-container report-area">
                        <!-- Pay period report content will be populated here -->
                         <p>Select a cycle start date and generate the report.</p>
                    </div>
                </div>
                
                <!-- Employee Summary Tab -->
                <div id="employee-summary" class="tab-content">
                    <div class="report-controls">
                        <div class="form-group">
                            <label for="reportEmployeeSelect">Select Employee:</label>
                            <select id="reportEmployeeSelect">
                                <!-- Options populated by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportEmployeeStartDate">Start Date:</label>
                            <input type="date" id="reportEmployeeStartDate">
                        </div>
                        <div class="form-group">
                            <label for="reportEmployeeEndDate">End Date:</label>
                            <input type="date" id="reportEmployeeEndDate">
                        </div>
                        <button id="generateEmployeeReportBtn" class="btn btn-primary">Generate Employee Report</button>
                        <button id="exportEmployeeReportBtn" class="btn btn-success" style="display:none;">Export Report (XLSX)</button>
                    </div>
                    <div id="employeeReportContentArea" class="table-container report-area">
                        <!-- Employee report content will be populated here -->
                        <p>Select an employee and date range to generate their summary.</p>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>Settings & Data Management</h2>
                </div>
                <div class="subsection">
                    <h3>Application Settings</h3>
                    <form id="appSettingsForm" class="form-grid">
                        <div class="form-group">
                            <label for="tipOutPercentage">Default Tip Out Percentage (%):</label>
                            <input type="number" id="tipOutPercentage" value="3" min="0" max="100" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="currencySymbolInput">Currency Symbol:</label>
                            <input type="text" id="currencySymbolInput" value="$">
                        </div>
                        <button type="submit" id="saveAppSettingsBtn" class="btn btn-primary">Save Settings</button>
                    </form>
                </div>

                <div class="subsection">
                    <h3>Manage Positions</h3>
                    <form id="positionsSettingsForm" class="form-grid">
                        <div class="form-group">
                            <label for="newPositionName">New Position Name:</label>
                            <input type="text" id="newPositionName" placeholder="e.g., Busser">
                        </div>
                        <button type="submit" id="addPositionBtn" class="btn btn-primary">Add Position</button>
                    </form>
                    <div id="positionsListContainer" class="table-container">
                        <h4>Current Positions:</h4>
                        <ul id="positionsList">
                            <!-- Positions list will be populated here by JS -->
                        </ul>
                    </div>
                </div>

                <div class="subsection">
                    <h3>Data Management</h3>
                    <div class="data-actions">
                        <button id="exportDataBtn" class="btn btn-primary">Export All Data (.json)</button>
                        <div>
                            <label for="importDataInput" class="btn btn-secondary">Import All Data (.json)</label>
                            <input type="file" id="importDataInput" accept=".json" style="display: none;">
                        </div>
                        <button id="clearAllDataBtn" class="btn btn-danger">Clear All Application Data</button>
                    </div>
                    <p class="warning">Warning: "Clear All Application Data" will permanently erase all employees, shifts, and settings. This action cannot be undone.</p>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>&copy; <span id="currentYear"></span> Toodie's TipSplit Deluxe. All Rights Reserved.</p>
            <p><a href="#" id="privacyPolicyLink">Privacy Policy</a> | <a href="#" id="termsOfServiceLink">Terms of Service</a></p>
        </footer>

        <!-- Tutorial Modal -->
        <div id="tutorialModal" class="modal">
            <div class="modal-content tutorial-modal-content">
                <span class="close-btn" id="tutorialCloseModalBtn">&times;</span>
                <h3 id="tutorialTitle">Tutorial Title</h3>
                <div id="tutorialBody">
                    <p>This is a step in the tutorial.</p>
                </div>
                <div class="tutorial-navigation">
                    <button id="tutorialPrevBtn" class="btn btn-secondary">&laquo; Previous</button>
                    <span id="tutorialStepIndicator">Step X of Y</span>
                    <button id="tutorialNextBtn" class="btn btn-primary">Next &raquo;</button>
                </div>
            </div>
        </div>

        <!-- Generic Modal for Confirmations/Alerts -->
        <div id="genericModal" class="modal">
            <div class="modal-content generic-modal-content">
                <span class="close-btn" id="genericModalCloseBtn">&times;</span>
                <h3 id="genericModalTitle">Confirmation</h3>
                <p id="genericModalBody">Are you sure you want to proceed?</p>
                <div class="modal-actions">
                    <button id="genericModalConfirmBtn" class="btn btn-primary">Confirm</button>
                    <button id="genericModalCancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script defer type="module" src="js/main.js"></script>
</body>
</html>