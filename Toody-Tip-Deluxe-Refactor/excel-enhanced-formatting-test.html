<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Enhanced Formatting Test</title>
    <!-- SheetJS Library for XLSX Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background-color: #e53935;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background-color: #c62828;
        }
        .info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        .sample-data {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Excel Enhanced Formatting Test</h1>
        
        <div class="info">
            <strong>Test Purpose:</strong> Verify that our enhanced Excel export formatting works correctly with currency and number formatting, even without visual styling support in the free SheetJS version.
        </div>

        <h2>Sample Data to Export</h2>
        <div class="sample-data">
            Employee: John Doe<br>
            Position: Server<br>
            Hours: 8.50<br>
            Wage: $127.50<br>
            Total Sales: $1,234.56<br>
            CC Tips: $185.18<br>
            Cash Tips: $45.20<br>
            Tips for Taxes: $230.38
        </div>

        <h2>Enhanced Formatting Features</h2>
        <ul>
            <li><strong>Currency Formatting:</strong> All monetary values formatted as $#,##0.00</li>
            <li><strong>Hours Formatting:</strong> Hours worked formatted as 0.00</li>
            <li><strong>Number Types:</strong> All numeric data properly typed for Excel calculations</li>
            <li><strong>Professional Appearance:</strong> Clean, business-ready formatting</li>
        </ul>

        <button onclick="testEnhancedFormatting()">Test Enhanced Formatting Export</button>

        <div class="info">
            <strong>Expected Result:</strong> Excel file should download with proper currency symbols ($), thousand separators (commas), and consistent decimal formatting - all without requiring visual styling features.
        </div>

        <div id="results" style="margin-top: 20px;"></div>
    </div>

    <script>
        function testEnhancedFormatting() {
            try {
                console.log("Starting enhanced formatting test...");
                
                // Create test data similar to what the app would export
                const testData = [
                    ["Employee", "Position", "Shift Time", "Hours", "Wage", "Total Sales", "CC Tips", "Cash Tips", "Tips for Taxes"],
                    ["John Doe", "Server", "09:00-17:30", 8.5, 127.50, 1234.56, 185.18, 45.20, 230.38],
                    ["Jane Smith", "Server", "17:00-23:00", 6.0, 90.00, 890.25, 133.54, 32.10, 165.64],
                    ["Mike Wilson", "Cook", "10:00-18:00", 8.0, 120.00, 0, 0, 0, 22.50],
                    ["Sarah Johnson", "Busser", "18:00-24:00", 6.0, 75.00, 0, 0, 0, 35.75]
                ];

                // Create workbook
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(testData);
                
                // Apply enhanced formatting (like in the main app)
                const range = XLSX.utils.decode_range(ws['!ref']);
                
                // Format currency columns (4,5,6,7,8 = Wage, Sales, CC Tips, Cash Tips, Tips for Taxes)
                const currencyColumns = [4, 5, 6, 7, 8];
                for (let R = 1; R <= range.e.r; ++R) { // Skip header row
                    currencyColumns.forEach(colIndex => {
                        if (colIndex <= range.e.c) {
                            const cellAddress = XLSX.utils.encode_cell({r: R, c: colIndex});
                            if (ws[cellAddress] && ws[cellAddress].v !== "" && !isNaN(ws[cellAddress].v)) {
                                ws[cellAddress].t = 'n'; // Number type
                                ws[cellAddress].z = '"$"#,##0.00'; // Currency format
                            }
                        }
                    });
                    
                    // Format hours column (column 3)
                    const hoursAddress = XLSX.utils.encode_cell({r: R, c: 3});
                    if (ws[hoursAddress] && ws[hoursAddress].v !== "" && !isNaN(ws[hoursAddress].v)) {
                        ws[hoursAddress].t = 'n';
                        ws[hoursAddress].z = '0.00'; // Two decimal places for hours
                    }
                }
                
                // Auto-fit columns
                const colWidths = testData[0].map((_, i) => ({wch: 15}));
                testData.forEach(row => {
                    row.forEach((cell, j) => {
                        const len = cell ? String(cell).length + 2 : 10;
                        if (colWidths[j].wch < len) colWidths[j].wch = len;
                    });
                });
                ws['!cols'] = colWidths;

                XLSX.utils.book_append_sheet(wb, ws, "Enhanced Format Test");

                // Generate filename and download
                const filename = `Enhanced_Formatting_Test_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, filename);
                
                document.getElementById('results').innerHTML = `
                    <div style="background-color: #d4edda; color: #155724; padding: 10px; border-radius: 5px; border: 1px solid #c3e6cb;">
                        <strong>✅ Test Complete!</strong><br>
                        Downloaded: ${filename}<br><br>
                        <strong>Check the Excel file for:</strong><br>
                        • Currency values with $ symbols and commas<br>
                        • Hours with consistent decimal formatting<br>
                        • Professional business-ready appearance<br>
                        • Proper number types for Excel calculations
                    </div>
                `;
                
                console.log("Enhanced formatting test completed successfully");
                
            } catch (error) {
                console.error("Test failed:", error);
                document.getElementById('results').innerHTML = `
                    <div style="background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; border: 1px solid #f5c6cb;">
                        <strong>❌ Test Failed!</strong><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
