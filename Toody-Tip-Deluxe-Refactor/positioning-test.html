<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Box Positioning Test</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        .test-container { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            background: #f0f0f0;
        }
        .test-highlight { 
            position: absolute; 
            background: rgba(255, 0, 0, 0.3); 
            border: 2px solid red; 
            cursor: pointer;
        }
        .test-textbox { 
            position: absolute; 
            background: white; 
            border: 2px solid black; 
            padding: 1em; 
            max-width: 400px;
            z-index: 1000;
        }
        .controls { 
            position: fixed; 
            top: 10px; 
            left: 10px; 
            background: white; 
            padding: 10px; 
            border: 1px solid #ccc;
            z-index: 2000;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="testPosition('center')">Test Center</button>
        <button onclick="testPosition('top-left')">Test Top-Left</button>
        <button onclick="testPosition('bottom-right')">Test Bottom-Right</button>
        <button onclick="testPosition('wide')">Test Wide Element</button>
        <button onclick="testPosition('tall')">Test Tall Element</button>
        <div id="status"></div>
    </div>
    
    <div class="test-container" id="container">
        <div class="test-highlight" id="highlight" style="width: 200px; height: 100px; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            Click to test positioning
        </div>
        <div class="test-textbox" id="textbox" style="display: none;">
            <h3>Tutorial Text Box</h3>
            <p>This is a test of the tutorial text box positioning algorithm. It should never overlap with the highlighted element.</p>
        </div>
    </div>

    <script>
        // Simplified version of the positioning algorithm for testing
        function positionTextBox(textBox, highlightRect) {
            const options = {
                verticalMargin: 40,
                horizontalMargin: 40,
                overlapBuffer: 20,
                minDistanceFromHighlight: 50,
            };

            function doesOverlap(r1, r2, buffer = options.overlapBuffer) {
                return !(
                    r1.left + r1.width + buffer < r2.left ||
                    r1.left > r2.left + r2.width + buffer ||
                    r1.top + r1.height + buffer < r2.top ||
                    r1.top > r2.top + r2.height + buffer
                );
            }

            textBox.style.display = 'block';
            let textBoxRect = textBox.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            const positionCalculators = {
                above: () => ({
                    top: highlightRect.top - textBoxRect.height - options.minDistanceFromHighlight,
                    left: highlightRect.left + (highlightRect.width / 2) - (textBoxRect.width / 2),
                }),
                below: () => ({
                    top: highlightRect.bottom + options.minDistanceFromHighlight,
                    left: highlightRect.left + (highlightRect.width / 2) - (textBoxRect.width / 2),
                }),
                right: () => ({
                    top: highlightRect.top + (highlightRect.height / 2) - (textBoxRect.height / 2),
                    left: highlightRect.right + options.minDistanceFromHighlight,
                }),
                left: () => ({
                    top: highlightRect.top + (highlightRect.height / 2) - (textBoxRect.height / 2),
                    left: highlightRect.left - textBoxRect.width - options.minDistanceFromHighlight,
                }),
            };

            const positionPreferences = ['above', 'below', 'right', 'left'];
            let newTop, newLeft, determinedPosition = '';

            for (const posName of positionPreferences) {
                const pos = positionCalculators[posName]();
                const candidateRect = {
                    top: pos.top,
                    left: pos.left,
                    width: textBoxRect.width,
                    height: textBoxRect.height,
                };

                const fitsViewport = 
                    candidateRect.top >= options.verticalMargin &&
                    candidateRect.left >= options.horizontalMargin &&
                    candidateRect.top + candidateRect.height <= viewportHeight - options.verticalMargin &&
                    candidateRect.left + candidateRect.width <= viewportWidth - options.horizontalMargin;

                if (fitsViewport && !doesOverlap(candidateRect, highlightRect)) {
                    newTop = candidateRect.top;
                    newLeft = candidateRect.left;
                    determinedPosition = `non-overlap-${posName}`;
                    break;
                }
            }

            if (!determinedPosition) {
                // Fallback to corner
                newTop = options.verticalMargin;
                newLeft = viewportWidth - textBoxRect.width - options.horizontalMargin;
                determinedPosition = 'fallback-top-right-corner';
            }

            textBox.style.top = newTop + 'px';
            textBox.style.left = newLeft + 'px';
            
            // Visual feedback
            const overlaps = doesOverlap({
                top: newTop, left: newLeft, 
                width: textBoxRect.width, height: textBoxRect.height
            }, highlightRect);
            
            document.getElementById('status').innerHTML = 
                `Position: ${determinedPosition}<br>` +
                `Location: (${Math.round(newTop)}, ${Math.round(newLeft)})<br>` +
                `Overlaps: ${overlaps ? 'YES ❌' : 'NO ✅'}`;
            
            textBox.style.borderColor = overlaps ? 'red' : 'green';
        }

        function testPosition(testType) {
            const highlight = document.getElementById('highlight');
            const textbox = document.getElementById('textbox');
            
            // Reset
            highlight.style.width = '200px';
            highlight.style.height = '100px';
            highlight.style.top = '50%';
            highlight.style.left = '50%';
            highlight.style.transform = 'translate(-50%, -50%)';
            
            switch(testType) {
                case 'center':
                    // Already centered
                    break;
                case 'top-left':
                    highlight.style.top = '10%';
                    highlight.style.left = '10%';
                    highlight.style.transform = 'none';
                    break;
                case 'bottom-right':
                    highlight.style.top = '80%';
                    highlight.style.left = '80%';
                    highlight.style.transform = 'none';
                    break;
                case 'wide':
                    highlight.style.width = '60%';
                    highlight.style.height = '50px';
                    break;
                case 'tall':
                    highlight.style.width = '100px';
                    highlight.style.height = '70%';
                    break;
            }
            
            setTimeout(() => {
                const rect = highlight.getBoundingClientRect();
                positionTextBox(textbox, rect);
            }, 50);
        }

        // Initial test
        document.getElementById('highlight').addEventListener('click', () => {
            const rect = document.getElementById('highlight').getBoundingClientRect();
            positionTextBox(document.getElementById('textbox'), rect);
        });
    </script>
</body>
</html>
