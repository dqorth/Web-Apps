<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug ActionsBefore</title>
    <style>
        .debug-box {
            border: 2px solid #4CAF50;
            padding: 20px;
            margin: 20px;
            background-color: #f9f9f9;
        }
        .status { font-weight: bold; margin: 10px 0; }
        .success { color: green; }
        .failure { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <div class="debug-box">
        <h2>ActionsBefore Debug Test</h2>
        <div id="test-status" class="status">Loading...</div>
        <div id="test-details"></div>
        <button onclick="runTests()">Run Tests</button>
        <button onclick="openMainApp()">Open Main App</button>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('test-status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function addDetail(message) {
            const detailsEl = document.getElementById('test-details');
            const div = document.createElement('div');
            div.textContent = message;
            detailsEl.appendChild(div);
        }

        function openMainApp() {
            window.open('index.html', '_blank');
        }

        async function runTests() {
            updateStatus('Running tests...', 'info');
            document.getElementById('test-details').innerHTML = '';

            try {
                // Test 1: Check if tutorial definitions have correct actionsBefore properties
                const response = await fetch('./js/state.js');
                const stateCode = await response.text();
                
                const hasActionsBefore = stateCode.includes('actionsBefore');
                const hasTriggerSelector = stateCode.includes('triggerSelector');
                const hasContentSelector = stateCode.includes('contentSelector');
                
                addDetail(`✓ ActionsBefore found in state.js: ${hasActionsBefore}`);
                addDetail(`✓ TriggerSelector property found: ${hasTriggerSelector}`);
                addDetail(`✓ ContentSelector property found: ${hasContentSelector}`);

                // Test 2: Check if tutorial function exists
                const tutorialResponse = await fetch('./js/ui/ui-tutorial.js');
                const tutorialCode = await tutorialResponse.text();
                
                const hasHandleDynamicStepActions = tutorialCode.includes('handleDynamicStepActions');
                const hasActionBeforeHandling = tutorialCode.includes('step.actionsBefore');
                
                addDetail(`✓ HandleDynamicStepActions function found: ${hasHandleDynamicStepActions}`);
                addDetail(`✓ ActionsBefore handling in tutorial: ${hasActionBeforeHandling}`);

                // Test 3: Check for collapsible section initialization
                const coreResponse = await fetch('./js/ui/ui-core.js');
                const coreCode = await coreResponse.text();
                
                const hasCollapsibleInit = coreCode.includes('initializeCollapsibleSections');
                const hasDefaultCollapsed = coreCode.includes('startCollapsed = storedState !== \'false\'');
                
                addDetail(`✓ Collapsible initialization found: ${hasCollapsibleInit}`);
                addDetail(`✓ Default collapsed logic found: ${hasDefaultCollapsed}`);

                if (hasActionsBefore && hasTriggerSelector && hasContentSelector && 
                    hasHandleDynamicStepActions && hasActionBeforeHandling && 
                    hasCollapsibleInit && hasDefaultCollapsed) {
                    updateStatus('All tests passed! ActionsBefore should be working.', 'success');
                    addDetail('');
                    addDetail('Next steps:');
                    addDetail('1. Open the main app');
                    addDetail('2. Verify sections are collapsed on load');
                    addDetail('3. Try the Data Management tutorial');
                    addDetail('4. Try the Weekly Report tutorial');
                } else {
                    updateStatus('Some tests failed. ActionsBefore may not work properly.', 'failure');
                }

            } catch (error) {
                updateStatus(`Error running tests: ${error.message}`, 'failure');
            }
        }

        // Auto-run tests on load
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
