<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExcelJS Export Test - Toody's TipSplit</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background-color: #d32f2f;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-button:hover {
            background-color: #b71c1c;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background-color: #e8f5e8; color: #2e7d2e; }
        .error { background-color: #ffeaa7; color: #d63031; }
        .info { background-color: #e3f2fd; color: #1565c0; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ ExcelJS Export Test</h1>
        <p>Test the new ExcelJS implementation with mock data to verify professional styling works correctly.</p>
        
        <button class="test-button" onclick="testExcelJSExport()">üî¨ Test ExcelJS Export</button>
        <button class="test-button" onclick="testMinimalExport()">üìä Test Minimal Export</button>
        
        <div id="status"></div>
        
        <h3>What This Test Validates:</h3>
        <ul>
            <li>‚úÖ ExcelJS library loads correctly</li>
            <li>‚úÖ Professional red headers with white bold text</li>
            <li>‚úÖ Zebra striping (alternating row colors)</li>
            <li>‚úÖ Professional borders around all cells</li>
            <li>‚úÖ Currency formatting ($#,##0.00)</li>
            <li>‚úÖ Number formatting for decimals</li>
            <li>‚úÖ Auto-sized columns</li>
            <li>‚úÖ File download mechanism</li>
        </ul>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function testMinimalExport() {
            updateStatus('üîÑ Testing minimal ExcelJS export...', 'info');
            
            try {
                // Create a simple workbook to test ExcelJS is working
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet('Test Sheet');
                
                worksheet.addRow(['Test', 'Data']);
                worksheet.addRow(['Hello', 'World']);
                
                // Try to generate and download
                workbook.xlsx.writeBuffer().then(function(buffer) {
                    const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'minimal-test.xlsx';
                    a.click();
                    window.URL.revokeObjectURL(url);
                    
                    updateStatus('‚úÖ Minimal export successful! ExcelJS library is working correctly.', 'success');
                }).catch(function(error) {
                    updateStatus(`‚ùå Export buffer error: ${error.message}`, 'error');
                });
                
            } catch (error) {
                updateStatus(`‚ùå ExcelJS test failed: ${error.message}`, 'error');
            }
        }

        function testExcelJSExport() {
            updateStatus('üîÑ Testing professional ExcelJS export with styling...', 'info');
            
            try {
                // Create workbook with professional styling
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet('Styled Test');
                
                // Professional styling definitions (same as in main app)
                const headerStyle = {
                    font: { bold: true, color: { argb: 'FFFFFFFF' } },
                    fill: { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFD32F2F' } },
                    alignment: { horizontal: 'center', vertical: 'middle' },
                    border: {
                        top: { style: 'medium', color: { argb: 'FF000000' } },
                        left: { style: 'medium', color: { argb: 'FF000000' } },
                        bottom: { style: 'medium', color: { argb: 'FF000000' } },
                        right: { style: 'medium', color: { argb: 'FF000000' } }
                    }
                };

                const evenRowStyle = {
                    fill: { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFF5F5F5' } },
                    border: {
                        top: { style: 'thin', color: { argb: 'FF808080' } },
                        left: { style: 'thin', color: { argb: 'FF808080' } },
                        bottom: { style: 'thin', color: { argb: 'FF808080' } },
                        right: { style: 'thin', color: { argb: 'FF808080' } }
                    }
                };

                const oddRowStyle = {
                    border: {
                        top: { style: 'thin', color: { argb: 'FF808080' } },
                        left: { style: 'thin', color: { argb: 'FF808080' } },
                        bottom: { style: 'thin', color: { argb: 'FF808080' } },
                        right: { style: 'thin', color: { argb: 'FF808080' } }
                    }
                };
                
                // Add headers
                const headers = ["Employee", "Position", "Hours", "Wage", "Tips"];
                worksheet.addRow(headers);
                const headerRow = worksheet.getRow(1);
                headerRow.eachCell((cell) => {
                    cell.style = headerStyle;
                });
                
                // Add sample data with styling
                const sampleData = [
                    ["Alice Johnson", "Server", 8.5, 85.00, 45.00],
                    ["Bob Smith", "Cook", 8.0, 120.00, 12.00],
                    ["Carol Davis", "Server", 6.5, 65.00, 38.50],
                    ["David Wilson", "Host", 7.0, 70.00, 15.00]
                ];
                
                sampleData.forEach((rowData, index) => {
                    worksheet.addRow(rowData);
                    const currentRow = worksheet.getRow(index + 2);
                    const rowStyle = (index + 2) % 2 === 0 ? evenRowStyle : oddRowStyle;
                    
                    currentRow.eachCell((cell, colNumber) => {
                        cell.style = { ...rowStyle };
                        
                        // Apply number formatting
                        if (colNumber === 3) { // Hours
                            cell.numFmt = '0.00';
                            cell.alignment = { horizontal: 'right', vertical: 'middle' };
                        } else if (colNumber >= 4) { // Currency columns
                            cell.numFmt = '"$"#,##0.00';
                            cell.alignment = { horizontal: 'right', vertical: 'middle' };
                        }
                    });
                });
                
                // Auto-fit columns
                worksheet.columns.forEach((column, index) => {
                    let maxLength = headers[index] ? headers[index].length : 10;
                    
                    sampleData.forEach(row => {
                        const cellValue = row[index] ? row[index].toString() : '';
                        maxLength = Math.max(maxLength, cellValue.length);
                    });
                    
                    column.width = Math.min(Math.max(maxLength + 2, 10), 20);
                });
                
                // Generate and download
                workbook.xlsx.writeBuffer().then(function(buffer) {
                    const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'professional-styled-test.xlsx';
                    a.click();
                    window.URL.revokeObjectURL(url);
                    
                    updateStatus('‚úÖ Professional styled export successful! Check the downloaded file for red headers, zebra striping, borders, and currency formatting.', 'success');
                }).catch(function(error) {
                    updateStatus(`‚ùå Styled export buffer error: ${error.message}`, 'error');
                });
                
            } catch (error) {
                updateStatus(`‚ùå Professional export test failed: ${error.message}`, 'error');
            }
        }

        // Test ExcelJS availability on load
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof ExcelJS !== 'undefined') {
                updateStatus('‚úÖ ExcelJS library loaded successfully. Ready for testing.', 'success');
            } else {
                updateStatus('‚ùå ExcelJS library failed to load. Check CDN connection.', 'error');
            }
        });
    </script>
</body>
</html>
